---
title: "**Advanced Reproducibility**"
output:
  html_document:
    toc: true
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    number_sections: false
css: style.css
editor_options:
  markdown:
    wrap: 72
---


# Activity 0: Set Up

### Installing Docker

<input type="checkbox"> Go here to [install Docker Desktop](https://www.docker.com/get-started), following the instructions for your particular operating system.
<input type="checkbox"> If you don't have a Docker account create an account when prompted, or [go here](https://hub.docker.com/).
After you install Docker, start up Docker Desktop by double clicking on the app. It may take some time to start up. 
<input type="checkbox"> Docker Desktop may ask you to log in to your Docker account. 

### Set up sandbox repository for this workshop

**NOTE: If you completed these steps for the previous workshop you don't need to do them again!**

#### Create your own copy of this repository

<input type="checkbox"> Go to the template repository for this workshop: https://github.com/fhdsl/reproducibility-sandbox  
<input type="checkbox"> Click the green `Use this template` button and then `Create a new repository`. If you don't see this button, you may need to expand your window.  
<input type="checkbox"> On the next screen, create a `Repository name`.   
<input type="checkbox"> Choose `Public`.  
<input type="checkbox"> Scroll to the bottom and click `Create repository`.  

#### Cloning our repository

<input type="checkbox"> Open up GitHub Desktop on your computer.  
<input type="checkbox"> Go to `File` > `Clone Repository`.  
<input type="checkbox"> Search for your ITN workshop repository name in the tab that says `Github.com`. Click on the name of this repository in this list. You can choose where you'd like it to download on your computer underneath `Local Path`.  
<input type="checkbox"> Click the blue `Clone` button.  

# Activity 1: Getting familiar with Docker/Podman

### Step 1: Docker pull

<input type="checkbox"> Open your terminal or command prompt window.

<input type="checkbox"> We need to get the Docker **image** we want to use. We do this by "pulling" it.

Run this command by copy pasting and clicking enter in your terminal:

```
docker pull jhudsl/reproducible-r
```

### Step 2: Check what images you have

<input type="checkbox"> After the last steps complete, to see what images we have we can run `docker image ls` and we should see `jhudsl/reproducible-r` show up now.

<input type="checkbox"> We can also check on the Images tab on the left menu in Docker Destop. We should see `jhudsl/reproducible-r` show up now.

### Step 3: Run the docker image to start a container!

<input type="checkbox"> Now if want to launch the image for use, we can use `docker run` to turn it into a **container**

```
docker run jhudsl/reproducible-r
```

<input type="checkbox"> To see what containers we have running we have we can run:

```
docker ps
```

### Step 4: Run a single command

<input type="checkbox"> To run stuff interactively from the command line we can do:

```
docker exec -it <PUT_CONTAINER_ID_HERE> bash
```

### Step 5: Try calling a script

<input type="checkbox"> To run a script using the docker container we could just add reference to a script at the end:

**BUT! You will find that this command won't work yet though, why?**

```
docker exec -it <PUT_CONTAINER_ID_HERE> bash run_analysis.sh
```

This won't work because the file `run_analysis.sh` is not a file that our container has. Docker containers do not have all the files that our computer does; they only have the files we add to it.

```
bash: run_analysis.sh: No such file or directory
```

### Step 6: Let’s add our reproducibility-sandbox files as a volume

Our container is separate from our computer so if we want to use a file we have to attach it using a "volume".

Point it so the volume has the workshop files

If we want to run `run_analysis.sh` there's two ways we could get our files on there.

- We could download the files we need from online! We could `git clone` files from a repository or otherwise `wget` or `curl` files.
- We could add a `volume` of files that are local to our computer. For this we will use the You'll `-v` or volume option.

### Step 7: Let’s add our reproducibility-sandbox files

We can specify a particular file path on our computer or give it `$PWD` Then optionally we can give a `:` and a file path we'd like this to be stored on on the container. Otherwise it will be stored at the absolute top of the container.

We are also going to add a port specification as well `-p 8787:8787` This will allow us to use RStudio on our container.

<input type="checkbox"> Now we can run:
```
docker run -v $PWD:/home -p 8787:8787 jhudsl/reproducible-r
```

### Step 8: Retry calling the script

<input type="checkbox"> Now we can run:
```
docker exec -it <REPLACE_WITH_CONTAINER_ID> bash /home/run_analysis.sh
```
And this should work!

### Step 9: Using RStudio from a container

<input type="checkbox"> Click on the link that says 8787:8787 at the top of your docker desktop OR go to your internet browser and type in `localhost:8787`.  
<input type="checkbox"> Now type in "rstudio" for your username and then find the password that was set in your docker logs and copy and past that for your password.   
<input type="checkbox"> Click submit.

Now you can develop code from a container that is shareable!

::: {.notice}
Keep in mind you can install packages from here but they will not be saved to the original image after you stop the container. To add software to your image you will need to modify your image which [you can find instructions on how to do this in our full course](https://hutchdatascience.org/Containers_for_Scientists/05-modifying-containers.html).
:::

# Activity 2: Getting familiar with GitHub Actions

## Step 1: Manually initiate a GitHub Action workflow

<input type="checkbox"> Go to your `reproducibility-sandbox` repository online on GitHub  
<input type="checkbox"> Click on the `Actions` tab.  
<input type="checkbox"> On the left side of the screen click on the `Render R Example` action.   
<input type="checkbox"> Click on the `Run workflow` dropdown menu and pick the green `Run workflow` button. You should see a light blue banner on the top that says "Worfklow run was successfully requested".   

## Step 2: Take a look at the workflow file

<input type="checkbox"> In your repository go to `.github/workflows/run-r-notebook.yml`.  
<input type="checkbox"> Take a look at this workflow file and try to answer these questions:

1. When will this workflow be run?
2. What will this workflow do when it is run?
3. What is this being run on -- what is the computing environment being used here?  

## Step 3: Take a look at your GitHub Action run!

<input type="checkbox"> You may need to refresh this page you are on.   
<input type="checkbox"> Click on the Workflow run in the center of the page that also says `Render R example`  
<input type="checkbox"> Click on the small box that says `render-notebooks`
<input type="checkbox"> Click on the dropdown arrow where it says `Run R analysis example`
